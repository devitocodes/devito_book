

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Simulation of waves on a string &#8212; The Devito Book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/02_wave/wave1D_fd1';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Implementation" href="wave1D_prog.html" />
    <link rel="prev" title="Coming soon" href="../01_vib/vib_placeholder.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/devito_logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/devito_logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../index.html">
                    Welcome to the Devito Book!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Vibration ODEs</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../01_vib/vib_undamped.html">Finite difference discretization</a></li>








<li class="toctree-l1"><a class="reference internal" href="../01_vib/vib_placeholder.html">Coming soon</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Wave equations</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Simulation of waves on a string</a></li>

<li class="toctree-l1"><a class="reference internal" href="wave1D_prog.html">Implementation</a></li>

<li class="toctree-l1"><a class="reference internal" href="wave_placeholder.html">Coming soon</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Diffusion equations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../03_diffu/diffu_rw.html">Random walk</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_diffu/diffu_placeholder.html">Coming soon</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Advection equations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../04_advec/advec.html">One-dimensional time-dependent advection equations</a></li>





</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Nonlinear problems</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../05_nonlin/nonlin_placeholder.html">Coming soon</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/devitocodes/devito_book" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/notebooks/02_wave/wave1D_fd1.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Simulation of waves on a string</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Simulation of waves on a string</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discretizing-the-domain">Discretizing the domain</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#uniform-meshes">Uniform meshes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-discrete-solution">The discrete solution</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fulfilling-the-equation-at-the-mesh-points">Fulfilling the equation at the mesh points</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#replacing-derivatives-by-finite-differences">Replacing derivatives by finite differences</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#algebraic-version-of-the-pde">Algebraic version of the PDE</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpretation-of-the-equation-as-a-stencil">Interpretation of the equation as a stencil</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#algebraic-version-of-the-initial-conditions">Algebraic version of the initial conditions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#formulating-a-recursive-algorithm">Formulating a recursive algorithm</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sketch-of-an-implementation">Sketch of an implementation</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#verification">Verification</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-slightly-generalized-model-problem">A slightly generalized model problem</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-an-analytical-solution-of-physical-significance">Using an analytical solution of physical significance</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#manufactured-solution-and-estimation-of-convergence-rates">Manufactured solution and estimation of convergence rates</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#specifying-the-solution-and-computing-corresponding-data">Specifying the solution and computing corresponding data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-a-single-discretization-parameter">Defining a single discretization parameter</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#computing-errors">Computing errors</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#computing-rates">Computing rates</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#constructing-an-exact-solution-of-the-discrete-equations">Constructing an exact solution of the discrete equations</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <p>A very wide range of physical processes lead to wave motion, where
signals are propagated through a medium in space and time, normally
with little or no permanent movement of the medium itself.
The shape of the signals may undergo changes as they travel through
matter, but usually not so much that the signals cannot be recognized
at some later point in space and time.
Many types of wave motion can be described by the equation
<span class="math notranslate nohighlight">\(u_{tt}=\nabla\cdot (c^2\nabla u) + f\)</span>, which we will solve
in the forthcoming text by finite difference methods.</p>
<section class="tex2jax_ignore mathjax_ignore" id="simulation-of-waves-on-a-string">
<h1>Simulation of waves on a string<a class="headerlink" href="#simulation-of-waves-on-a-string" title="Permalink to this heading">#</a></h1>
<div id="wave:string"></div>
<p>We begin our study of wave equations by simulating one-dimensional
waves on a string, say on a guitar or violin.
Let the string in the undeformed state
coincide with the interval
<span class="math notranslate nohighlight">\([0,L]\)</span> on the <span class="math notranslate nohighlight">\(x\)</span> axis, and let <span class="math notranslate nohighlight">\(u(x,t)\)</span> be the displacement at
time <span class="math notranslate nohighlight">\(t\)</span> in the <span class="math notranslate nohighlight">\(y\)</span> direction of a point initially at <span class="math notranslate nohighlight">\(x\)</span>.
The displacement function <span class="math notranslate nohighlight">\(u\)</span> is governed by the mathematical model</p>
<!-- Equation labels as ordinary links -->
<div id="wave:pde1"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
\frac{\partial^2 u}{\partial t^2} =
c^2 \frac{\partial^2 u}{\partial x^2}, \quad x\in (0,L),\ t\in (0,T]
\label{wave:pde1} \tag{1}
\end{equation}
\]</div>
<!-- Equation labels as ordinary links -->
<div id="wave:pde1:ic:u"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}  
u(x,0) = I(x), \quad x\in [0,L]
\label{wave:pde1:ic:u} \tag{2}
\end{equation}
\]</div>
<!-- Equation labels as ordinary links -->
<div id="wave:pde1:ic:ut"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}  
\frac{\partial}{\partial t}u(x,0) = 0, \quad x\in [0,L]
\label{wave:pde1:ic:ut} \tag{3}
\end{equation}
\]</div>
<!-- Equation labels as ordinary links -->
<div id="wave:pde1:bc:0"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}  
u(0,t)  = 0, \quad  t\in (0,T]
\label{wave:pde1:bc:0} \tag{4}
\end{equation}
\]</div>
<!-- Equation labels as ordinary links -->
<div id="wave:pde1:bc:L"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}  
u(L,t)  = 0, \quad  t\in (0,T]
\label{wave:pde1:bc:L} \tag{5}
\end{equation}
\]</div>
<p>The constant <span class="math notranslate nohighlight">\(c\)</span> and the function <span class="math notranslate nohighlight">\(I(x)\)</span> must be prescribed.</p>
<p>Equation (<span class="xref myst">1</span>) is known as the one-dimensional
<em>wave equation</em>. Since this PDE contains a second-order derivative
in time, we need <em>two initial conditions</em>. The condition
(<span class="xref myst">2</span>) specifies
the initial shape of the string, <span class="math notranslate nohighlight">\(I(x)\)</span>, and
(<span class="xref myst">3</span>) expresses that the initial velocity of the
string is zero. In addition, PDEs need <em>boundary conditions</em>, given here as
(<span class="xref myst">4</span>) and (<span class="xref myst">5</span>). These two
conditions specify that
the string is fixed at the ends, i.e., that the displacement <span class="math notranslate nohighlight">\(u\)</span> is zero.</p>
<p>The solution <span class="math notranslate nohighlight">\(u(x,t)\)</span> varies in space and time and describes waves that
move with velocity <span class="math notranslate nohighlight">\(c\)</span> to the left and right.</p>
<p>Sometimes we will use a more compact notation for the partial derivatives
to save space:</p>
<!-- Equation labels as ordinary links -->
<div id="_auto1"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
u_t = \frac{\partial u}{\partial t}, \quad
u_{tt} = \frac{\partial^2 u}{\partial t^2},
\label{_auto1} \tag{6}
\end{equation}
\]</div>
<p>and similar expressions
for derivatives with respect to other variables. Then the
wave equation can be written compactly as <span class="math notranslate nohighlight">\(u_{tt} = c^2u_{xx}\)</span>.</p>
<p>The PDE problem (<span class="xref myst">1</span>)-(<span class="xref myst">5</span>) will now be
discretized in space and time by a finite difference method.</p>
<section id="discretizing-the-domain">
<h2>Discretizing the domain<a class="headerlink" href="#discretizing-the-domain" title="Permalink to this heading">#</a></h2>
<div id="wave:string:mesh"></div>
<p>The temporal domain <span class="math notranslate nohighlight">\([0,T]\)</span> is represented by a finite number of mesh points</p>
<!-- Equation labels as ordinary links -->
<div id="_auto2"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
0 = t_0 &lt; t_1 &lt; t_2 &lt; \cdots &lt; t_{N_t-1} &lt; t_{N_t} = T    \label{_auto2} \tag{7}
\end{equation}
\]</div>
<p>Similarly, the spatial domain <span class="math notranslate nohighlight">\([0,L]\)</span> is replaced by a set of mesh points</p>
<!-- Equation labels as ordinary links -->
<div id="_auto3"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
0 = x_0 &lt; x_1 &lt; x_2 &lt; \cdots &lt; x_{N_x-1} &lt; x_{N_x} = L   \label{_auto3} \tag{8}
\end{equation}
\]</div>
<p>One may view the mesh as two-dimensional in the <span class="math notranslate nohighlight">\(x,t\)</span> plane, consisting
of points <span class="math notranslate nohighlight">\((x_i, t_n)\)</span>, with <span class="math notranslate nohighlight">\(i=0,\ldots,N_x\)</span> and <span class="math notranslate nohighlight">\(n=0,\ldots,N_t\)</span>.</p>
<section id="uniform-meshes">
<h3>Uniform meshes<a class="headerlink" href="#uniform-meshes" title="Permalink to this heading">#</a></h3>
<p>For uniformly distributed mesh points we can introduce the constant
mesh spacings <span class="math notranslate nohighlight">\(\Delta t\)</span> and <span class="math notranslate nohighlight">\(\Delta x\)</span>. We have that</p>
<!-- Equation labels as ordinary links -->
<div id="_auto4"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
x_i = i\Delta x,\ i=0,\ldots,N_x,\quad
t_n = n\Delta t,\ n=0,\ldots,N_t
\label{_auto4} \tag{9}
\end{equation}
\]</div>
<p>We also have that <span class="math notranslate nohighlight">\(\Delta x = x_i-x_{i-1}\)</span>, <span class="math notranslate nohighlight">\(i=1,\ldots,N_x\)</span>, and
<span class="math notranslate nohighlight">\(\Delta t = t_n - t_{n-1}\)</span>, <span class="math notranslate nohighlight">\(n=1,\ldots,N_t\)</span>. <span class="xref myst">Figure</span>
displays a mesh in the <span class="math notranslate nohighlight">\(x,t\)</span> plane with <span class="math notranslate nohighlight">\(N_t=5\)</span>, <span class="math notranslate nohighlight">\(N_x=5\)</span>, and constant
mesh spacings.</p>
</section>
</section>
<section id="the-discrete-solution">
<h2>The discrete solution<a class="headerlink" href="#the-discrete-solution" title="Permalink to this heading">#</a></h2>
<div id="wave:string:numerical:sol"></div>
<p>The solution <span class="math notranslate nohighlight">\(u(x,t)\)</span> is sought at the mesh points. We introduce
the mesh function <span class="math notranslate nohighlight">\(u_i^n\)</span>, which approximates the exact
solution at the
mesh point <span class="math notranslate nohighlight">\((x_i,t_n)\)</span> for <span class="math notranslate nohighlight">\(i=0,\ldots,N_x\)</span> and <span class="math notranslate nohighlight">\(n=0,\ldots,N_t\)</span>.
Using the finite difference method, we shall
develop algebraic equations for computing the mesh function.</p>
</section>
<section id="fulfilling-the-equation-at-the-mesh-points">
<h2>Fulfilling the equation at the mesh points<a class="headerlink" href="#fulfilling-the-equation-at-the-mesh-points" title="Permalink to this heading">#</a></h2>
<div id="wave:string:samplingPDE"></div>
<p>In the finite difference method, we relax
the condition that (<span class="xref myst">1</span>) holds at all points in
the space-time domain <span class="math notranslate nohighlight">\((0,L)\times (0,T]\)</span> to the requirement that the PDE is
fulfilled at the <em>interior</em> mesh points only:</p>
<!-- Equation labels as ordinary links -->
<div id="wave:pde1:step2"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
\frac{\partial^2}{\partial t^2} u(x_i, t_n) =
c^2\frac{\partial^2}{\partial x^2} u(x_i, t_n),
\label{wave:pde1:step2} \tag{10}
\end{equation}
\]</div>
<p>for <span class="math notranslate nohighlight">\(i=1,\ldots,N_x-1\)</span> and <span class="math notranslate nohighlight">\(n=1,\ldots,N_t-1\)</span>. For <span class="math notranslate nohighlight">\(n=0\)</span> we have
the initial conditions <span class="math notranslate nohighlight">\(u=I(x)\)</span> and <span class="math notranslate nohighlight">\(u_t=0\)</span>,
and at the boundaries <span class="math notranslate nohighlight">\(i=0,N_x\)</span> we
have the boundary condition <span class="math notranslate nohighlight">\(u=0\)</span>.</p>
</section>
<section id="replacing-derivatives-by-finite-differences">
<h2>Replacing derivatives by finite differences<a class="headerlink" href="#replacing-derivatives-by-finite-differences" title="Permalink to this heading">#</a></h2>
<div id="wave:string:fd"></div>
<p>The second-order derivatives can be replaced by central
differences. The most widely used difference approximation of
the second-order derivative is</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial^2}{\partial t^2}u(x_i,t_n)\approx
\frac{u_i^{n+1} - 2u_i^n + u^{n-1}_i}{\Delta t^2}\
\]</div>
<p>mathcal{I}_t is convenient to introduce the finite difference operator notation</p>
<div class="math notranslate nohighlight">
\[
[D_tD_t u]^n_i = \frac{u_i^{n+1} - 2u_i^n + u^{n-1}_i}{\Delta t^2}
\]</div>
<p>A similar approximation of the second-order derivative in the <span class="math notranslate nohighlight">\(x\)</span>
direction reads</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial^2}{\partial x^2}u(x_i,t_n)\approx
\frac{u_{i+1}^{n} - 2u_i^n + u^{n}_{i-1}}{\Delta x^2} = [D_xD_x u]^n_i
\]</div>
<section id="algebraic-version-of-the-pde">
<h3>Algebraic version of the PDE<a class="headerlink" href="#algebraic-version-of-the-pde" title="Permalink to this heading">#</a></h3>
<p>We can now replace the derivatives in (<span class="xref myst">10</span>)
and get</p>
<!-- Equation labels as ordinary links -->
<div id="wave:pde1:step3b"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
\frac{u_i^{n+1} - 2u_i^n + u^{n-1}_i}{\Delta t^2} =
c^2\frac{u_{i+1}^{n} - 2u_i^n + u^{n}_{i-1}}{\Delta x^2},
\label{wave:pde1:step3b} \tag{11}
\end{equation}
\]</div>
<p>or written more compactly using the operator notation:</p>
<!-- Equation labels as ordinary links -->
<div id="wave:pde1:step3a"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
[D_tD_t u = c^2 D_xD_x]^{n}_i
\label{wave:pde1:step3a} \tag{12}
\end{equation}
\]</div>
</section>
<section id="interpretation-of-the-equation-as-a-stencil">
<h3>Interpretation of the equation as a stencil<a class="headerlink" href="#interpretation-of-the-equation-as-a-stencil" title="Permalink to this heading">#</a></h3>
<p>A characteristic feature of (<span class="xref myst">11</span>) is that it
involves <span class="math notranslate nohighlight">\(u\)</span> values from neighboring points only: <span class="math notranslate nohighlight">\(u_i^{n+1}\)</span>,
<span class="math notranslate nohighlight">\(u^n_{i\pm 1}\)</span>, <span class="math notranslate nohighlight">\(u^n_i\)</span>, and <span class="math notranslate nohighlight">\(u^{n-1}_i\)</span>.  The circles in <span class="xref myst">Figure</span> illustrate such neighboring mesh points that
contribute to an algebraic equation. In this particular case, we have
sampled the PDE at the point <span class="math notranslate nohighlight">\((2,2)\)</span> and constructed
(<span class="xref myst">11</span>), which then involves a coupling of <span class="math notranslate nohighlight">\(u_1^2\)</span>,
<span class="math notranslate nohighlight">\(u_2^3\)</span>, <span class="math notranslate nohighlight">\(u_2^2\)</span>, <span class="math notranslate nohighlight">\(u_2^1\)</span>, and <span class="math notranslate nohighlight">\(u_3^2\)</span>.  The term <em>stencil</em> is often
used about the algebraic equation at a mesh point, and the geometry of
a typical stencil is illustrated in <span class="xref myst">Figure</span>. One also often refers to the algebraic
equations as <em>discrete equations</em>, <em>(finite) difference equations</em> or
a <em>finite difference scheme</em>.</p>
<!-- dom:FIGURE: [mov-wave/D_stencil_gpl/stencil_n_interior.png, width=500] Mesh in space and time. The circles show points connected in a finite difference equation. <div id="wave:pde1:fig:mesh"></div> -->
<!-- begin figure -->
<div id="wave:pde1:fig:mesh"></div>
<p>Mesh in space and time. The circles show points connected in a finite difference equation.</p>
<img src="mov-wave/D_stencil_gpl/stencil_n_interior.png" width=500>
<!-- end figure -->
</section>
<section id="algebraic-version-of-the-initial-conditions">
<h3>Algebraic version of the initial conditions<a class="headerlink" href="#algebraic-version-of-the-initial-conditions" title="Permalink to this heading">#</a></h3>
<p>We also need to replace the derivative in the initial condition
(<span class="xref myst">3</span>) by a finite difference approximation.
A centered difference of the type</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial}{\partial t} u(x_i,t_0)\approx
\frac{u^1_i - u^{-1}_i}{2\Delta t} = [D_{2t} u]^0_i,
\]</div>
<p>seems appropriate. Writing out this equation and ordering the terms give</p>
<!-- Equation labels as ordinary links -->
<div id="wave:pde1:step3c"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
u^{-1}_i=u^{1}_i,\quad i=0,\ldots,N_x
\label{wave:pde1:step3c} \tag{13}
\end{equation}
\]</div>
<p>The other initial condition can be computed by</p>
<div class="math notranslate nohighlight">
\[
u_i^0 = I(x_i),\quad i=0,\ldots,N_x
\]</div>
</section>
</section>
<section id="formulating-a-recursive-algorithm">
<h2>Formulating a recursive algorithm<a class="headerlink" href="#formulating-a-recursive-algorithm" title="Permalink to this heading">#</a></h2>
<div id="wave:string:alg"></div>
<p>We assume that <span class="math notranslate nohighlight">\(u^n_i\)</span> and <span class="math notranslate nohighlight">\(u^{n-1}_i\)</span> are available for
<span class="math notranslate nohighlight">\(i=0,\ldots,N_x\)</span>.  The only unknown quantity in
(<span class="xref myst">11</span>) is therefore <span class="math notranslate nohighlight">\(u^{n+1}_i\)</span>, which we now can
solve for:</p>
<!-- Equation labels as ordinary links -->
<div id="wave:pde1:step4"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
u^{n+1}_i = -u^{n-1}_i + 2u^n_i + C^2
\left(u^{n}_{i+1}-2u^{n}_{i} + u^{n}_{i-1}\right)
\label{wave:pde1:step4} \tag{14}
\end{equation}
\]</div>
<p>We have here introduced the parameter</p>
<!-- Equation labels as ordinary links -->
<div id="_auto5"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
C = c\frac{\Delta t}{\Delta x},
\label{_auto5} \tag{15}
\end{equation}
\]</div>
<p>known as the <em>Courant number</em>.</p>
<p><strong><span class="math notranslate nohighlight">\(C\)</span> is the key parameter in the discrete wave equation.</strong></p>
<p>We see that the discrete version of the PDE features only one
parameter, <span class="math notranslate nohighlight">\(C\)</span>, which is therefore the key parameter, together with
<span class="math notranslate nohighlight">\(N_x\)</span>, that governs the quality of the numerical solution (see the section <span class="xref myst">Analysis of the difference equations</span> for details). Both the primary physical
parameter <span class="math notranslate nohighlight">\(c\)</span> and the numerical parameters <span class="math notranslate nohighlight">\(\Delta x\)</span> and <span class="math notranslate nohighlight">\(\Delta t\)</span>
are lumped together in <span class="math notranslate nohighlight">\(C\)</span>. Note that <span class="math notranslate nohighlight">\(C\)</span> is a dimensionless
parameter.</p>
<p>Given that <span class="math notranslate nohighlight">\(u^{n-1}_i\)</span> and <span class="math notranslate nohighlight">\(u^n_i\)</span> are known for <span class="math notranslate nohighlight">\(i=0,\ldots,N_x\)</span>,
we find new values at the next time level by applying the formula
(<span class="xref myst">14</span>) for <span class="math notranslate nohighlight">\(i=1,\ldots,N_x-1\)</span>. <span class="xref myst">Figure</span> illustrates the points that are used to
compute <span class="math notranslate nohighlight">\(u^3_2\)</span>. For the boundary points, <span class="math notranslate nohighlight">\(i=0\)</span> and <span class="math notranslate nohighlight">\(i=N_x\)</span>, we apply
the boundary conditions <span class="math notranslate nohighlight">\(u_i^{n+1}=0\)</span>.</p>
<p>Even though sound reasoning leads up to
(<span class="xref myst">14</span>), there is still a minor challenge with it that needs
to be resolved. Think of the very first computational step to be made.
The scheme (<span class="xref myst">14</span>) is supposed to start at <span class="math notranslate nohighlight">\(n=1\)</span>, which means
that we compute <span class="math notranslate nohighlight">\(u^2\)</span> from <span class="math notranslate nohighlight">\(u^1\)</span> and <span class="math notranslate nohighlight">\(u^0\)</span>. Unfortunately, we do not know the
value of <span class="math notranslate nohighlight">\(u^1\)</span>, so how to proceed? A standard procedure in such cases is to
apply (<span class="xref myst">14</span>) also for <span class="math notranslate nohighlight">\(n=0\)</span>. This immediately seems strange,
since it involves <span class="math notranslate nohighlight">\(u^{-1}_i\)</span>, which is an undefined
quantity outside the time mesh (and the time domain). However, we can
use the initial condition (<span class="xref myst">13</span>) in combination with
(<span class="xref myst">14</span>) when <span class="math notranslate nohighlight">\(n=0\)</span> to eliminate <span class="math notranslate nohighlight">\(u^{-1}_i\)</span> and
arrive at a special formula for <span class="math notranslate nohighlight">\(u_i^1\)</span>:</p>
<!-- Equation labels as ordinary links -->
<div id="wave:pde1:step4:1"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
u_i^1 = u^0_i - \frac{1}{2}
C^2\left(u^{0}_{i+1}-2u^{0}_{i} + u^{0}_{i-1}\right)
\label{wave:pde1:step4:1} \tag{16}
\end{equation}
\]</div>
<p><span class="xref myst">Figure</span> illustrates how (<span class="xref myst">16</span>)
connects four instead of five points: <span class="math notranslate nohighlight">\(u^1_2\)</span>, <span class="math notranslate nohighlight">\(u_1^0\)</span>, <span class="math notranslate nohighlight">\(u_2^0\)</span>, and <span class="math notranslate nohighlight">\(u_3^0\)</span>.</p>
<!-- dom:FIGURE: [mov-wave/D_stencil_gpl/stencil_n0_interior.png, width=500] Modified stencil for the first time step. <div id="wave:pde1:fig:stencil:u1"></div> -->
<!-- begin figure -->
<div id="wave:pde1:fig:stencil:u1"></div>
<p>Modified stencil for the first time step.</p>
<img src="mov-wave/D_stencil_gpl/stencil_n0_interior.png" width=500>
<!-- end figure -->
<p>We can now summarize the computational algorithm:</p>
<ol class="arabic">
<li><p>Compute <span class="math notranslate nohighlight">\(u^0_i=I(x_i)\)</span> for <span class="math notranslate nohighlight">\(i=0,\ldots,N_x\)</span></p></li>
<li><p>Compute <span class="math notranslate nohighlight">\(u^1_i\)</span> by (<span class="xref myst">16</span>) for <span class="math notranslate nohighlight">\(i=1,2,\ldots,N_x-1\)</span> and set <span class="math notranslate nohighlight">\(u_i^1=0\)</span>
for the boundary points given by <span class="math notranslate nohighlight">\(i=0\)</span> and <span class="math notranslate nohighlight">\(i=N_x\)</span>,</p></li>
<li><p>For each time level <span class="math notranslate nohighlight">\(n=1,2,\ldots,N_t-1\)</span></p>
<p>a. apply (<span class="xref myst">14</span>) to find <span class="math notranslate nohighlight">\(u^{n+1}_i\)</span> for <span class="math notranslate nohighlight">\(i=1,\ldots,N_x-1\)</span></p>
<p>b. set <span class="math notranslate nohighlight">\(u^{n+1}_i=0\)</span> for the boundary points having <span class="math notranslate nohighlight">\(i=0\)</span>, <span class="math notranslate nohighlight">\(i=N_x\)</span>.</p>
</li>
</ol>
<p>The algorithm essentially consists of moving a finite difference
stencil through all the mesh points, which can be seen as an animation
in a <a class="reference download internal" download="" href="../../_downloads/b4d5ff9342b79f4b2b26ae7292d3bea4/index.html"><span class="xref download myst">web page</span></a>
or a <a class="reference download internal" download="" href="../../_downloads/c4203bb9b8edc889e40f373bad1b9531/movie.ogg"><span class="xref download myst">movie file</span></a>.</p>
</section>
<section id="sketch-of-an-implementation">
<h2>Sketch of an implementation<a class="headerlink" href="#sketch-of-an-implementation" title="Permalink to this heading">#</a></h2>
<div id="wave:string:impl"></div>
<p>We start by defining some constants that will be used throughout our Devito code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Given mesh points as arrays x and t (x[i], t[n]),</span>
<span class="c1"># constant c and function I for initial condition</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">I</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">dx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span>            <span class="c1"># Courant number</span>
<span class="n">Nx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
<span class="n">Nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
<span class="n">C2</span> <span class="o">=</span> <span class="n">C</span><span class="o">**</span><span class="mi">2</span>              <span class="c1"># Help variable in the scheme</span>
<span class="n">L</span> <span class="o">=</span> <span class="mf">2.</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we define our 1D computational grid and create a function <code class="docutils literal notranslate"><span class="pre">u</span></code> as a symbolic <code class="docutils literal notranslate"><span class="pre">devito.TimeFunction</span></code>. We need to specify the <code class="docutils literal notranslate"><span class="pre">space_order</span></code> as 2 since our wave equation involves second-order derivatives with respect to <span class="math notranslate nohighlight">\(x\)</span>. Similarly, we specify the <code class="docutils literal notranslate"><span class="pre">time_order</span></code> as 2, as our equation involves second-order derivatives with respect to <span class="math notranslate nohighlight">\(t\)</span>. Setting these parameters allows us to use <code class="docutils literal notranslate"><span class="pre">u.dx2</span></code> and <code class="docutils literal notranslate"><span class="pre">u.dt2</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">devito</span> <span class="kn">import</span> <span class="n">Grid</span><span class="p">,</span> <span class="n">TimeFunction</span>

<span class="c1"># Initialise `u` for space and time order 2, using initialisation function I</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">Grid</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">Nx</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="n">L</span><span class="p">))</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">TimeFunction</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;u&#39;</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="n">grid</span><span class="p">,</span> <span class="n">time_order</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">space_order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">u</span><span class="o">.</span><span class="n">data</span><span class="p">[:,:]</span> <span class="o">=</span> <span class="n">I</span><span class="p">(</span><span class="n">x</span><span class="p">[:])</span>
</pre></div>
</div>
</div>
</div>
<p>Now that we have initialised <code class="docutils literal notranslate"><span class="pre">u</span></code>, we can solve our wave equation for the unknown quantity <span class="math notranslate nohighlight">\(u^{n+1}_i\)</span> using forward and backward differences in space and time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">devito</span> <span class="kn">import</span> <span class="n">Constant</span><span class="p">,</span> <span class="n">Eq</span><span class="p">,</span> <span class="n">solve</span>

<span class="c1"># Set up wave equation and solve for forward stencil point in time</span>
<span class="n">pde</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">dt2</span><span class="o">-</span><span class="n">u</span><span class="o">.</span><span class="n">dx2</span>
<span class="n">stencil</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">forward</span><span class="p">,</span> <span class="n">solve</span><span class="p">(</span><span class="n">pde</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">forward</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LHS: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stencil</span><span class="o">.</span><span class="n">lhs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RHS: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stencil</span><span class="o">.</span><span class="n">rhs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LHS: u(t + dt, x)
RHS: dt**2*(-(-2.0*u(t, x)/dt**2 + u(t - dt, x)/dt**2) + Derivative(u(t, x), (x, 2)))
</pre></div>
</div>
</div>
</div>
<p>Great! From these print statements, we can see that Devito has taken the wave equation in (<span class="xref myst">1</span>) and solved it for <span class="math notranslate nohighlight">\(u^{n+1}_i\)</span>, giving us equation (<span class="xref myst">14</span>). Note that <code class="docutils literal notranslate"><span class="pre">dx</span></code> is denoted as <code class="docutils literal notranslate"><span class="pre">h_x</span></code>, while <code class="docutils literal notranslate"><span class="pre">u(t,</span> <span class="pre">x)</span></code>, <code class="docutils literal notranslate"><span class="pre">u(t,</span> <span class="pre">x</span> <span class="pre">-</span> <span class="pre">h_x)</span></code> and <code class="docutils literal notranslate"><span class="pre">u(t,</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">h_x)</span></code> denote the equivalent of <span class="math notranslate nohighlight">\(u^{n}_{i}\)</span>, <span class="math notranslate nohighlight">\(u^{n}_{i-1}\)</span> and <span class="math notranslate nohighlight">\(u^{n}_{i+1}\)</span> respectively.</p>
<p>We also need to create a separate stencil for the first timestep, where we substitute <span class="math notranslate nohighlight">\(u^{1}_i\)</span> for <span class="math notranslate nohighlight">\(u^{-1}_i\)</span>, as given in (<span class="xref myst">13</span>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stencil_init</span> <span class="o">=</span> <span class="n">stencil</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">backward</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">forward</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can create expressions for our boundary conditions and build the operator. The results are plotted below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#NBVAL_IGNORE_OUTPUT</span>
<span class="kn">from</span> <span class="nn">devito</span> <span class="kn">import</span> <span class="n">Operator</span>

<span class="n">t_s</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">stepping_dim</span>  

<span class="c1"># Boundary conditions</span>
<span class="n">bc</span> <span class="o">=</span> <span class="p">[</span><span class="n">Eq</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">t_s</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)]</span>
<span class="n">bc</span> <span class="o">+=</span> <span class="p">[</span><span class="n">Eq</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">t_s</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nx</span><span class="p">],</span> <span class="mi">0</span><span class="p">)]</span>

<span class="c1"># Defining one Operator for initial timestep and one for the rest</span>
<span class="n">op_init</span> <span class="o">=</span> <span class="n">Operator</span><span class="p">([</span><span class="n">stencil_init</span><span class="p">]</span><span class="o">+</span><span class="n">bc</span><span class="p">)</span>
<span class="n">op</span> <span class="o">=</span> <span class="n">Operator</span><span class="p">([</span><span class="n">stencil</span><span class="p">]</span><span class="o">+</span><span class="n">bc</span><span class="p">)</span>
    
<span class="n">op_init</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">time_M</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
<span class="n">op</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">time_m</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">time_M</span><span class="o">=</span><span class="n">Nt</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Operator `Kernel` ran in 0.01 s
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Operator `Kernel` ran in 0.01 s
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PerformanceSummary([(PerfKey(name=&#39;section0&#39;, rank=None),
                     PerfEntry(time=8e-06, gflopss=0.0, gpointss=0.0, oi=0.0, ops=0, itershapes=[]))])
</pre></div>
</div>
</div>
</div>
<p>We can plot our results using <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/hostedtoolcache/Python/3.9.17/x64/lib/python3.9/site-packages/numpy/core/getlimits.py:549: UserWarning: The value of the smallest subnormal for &lt;class &#39;numpy.float64&#39;&gt; type is zero.
  setattr(self, word, getattr(machar, word).flat[0])
/opt/hostedtoolcache/Python/3.9.17/x64/lib/python3.9/site-packages/numpy/core/getlimits.py:89: UserWarning: The value of the smallest subnormal for &lt;class &#39;numpy.float64&#39;&gt; type is zero.
  return self._float_to_str(self.smallest_subnormal)
</pre></div>
</div>
<img alt="../../_images/1339663daac7f5c52645b55c331ebaa4e4a281d9e8bb88fbc12c3a5a634ac2f4.png" src="../../_images/1339663daac7f5c52645b55c331ebaa4e4a281d9e8bb88fbc12c3a5a634ac2f4.png" />
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="verification">
<h1>Verification<a class="headerlink" href="#verification" title="Permalink to this heading">#</a></h1>
<p>Before implementing the algorithm, it is convenient to add a source
term to the PDE (<span class="xref myst">1</span>), since that gives us more freedom in
finding test problems for verification. Physically, a source term acts
as a generator for waves in the interior of the domain.</p>
<section id="a-slightly-generalized-model-problem">
<h2>A slightly generalized model problem<a class="headerlink" href="#a-slightly-generalized-model-problem" title="Permalink to this heading">#</a></h2>
<div id="wave:pde2:fd"></div>
<p>We now address the following extended initial-boundary value problem
for one-dimensional wave phenomena:</p>
<!-- Equation labels as ordinary links -->
<div id="wave:pde2"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
u_{tt} = c^2 u_{xx} + f(x,t), \quad x\in (0,L),\ t\in (0,T]
\label{wave:pde2} \tag{17}
\end{equation}
\]</div>
<!-- Equation labels as ordinary links -->
<div id="wave:pde2:ic:u"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}  
u(x,0) = I(x), \quad x\in [0,L]
\label{wave:pde2:ic:u} \tag{18}
\end{equation}
\]</div>
<!-- Equation labels as ordinary links -->
<div id="wave:pde2:ic:ut"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}  
u_t(x,0) = V(x), \quad x\in [0,L]
\label{wave:pde2:ic:ut} \tag{19}
\end{equation}
\]</div>
<!-- Equation labels as ordinary links -->
<div id="wave:pde2:bc:0"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}  
u(0,t)  = 0, \quad  t&gt;0
\label{wave:pde2:bc:0} \tag{20}
\end{equation}
\]</div>
<!-- Equation labels as ordinary links -->
<div id="wave:pde2:bc:L"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}  
u(L,t)  = 0, \quad  t&gt;0
\label{wave:pde2:bc:L} \tag{21}
\end{equation}
\]</div>
<p>Sampling the PDE at <span class="math notranslate nohighlight">\((x_i,t_n)\)</span> and using the same finite difference
approximations as above, yields</p>
<!-- Equation labels as ordinary links -->
<div id="wave:pde2:fdop"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
[D_tD_t u = c^2 D_xD_x u + f]^{n}_i
\label{wave:pde2:fdop} \tag{22}
\end{equation}
\]</div>
<p>Writing this out and solving for the unknown <span class="math notranslate nohighlight">\(u^{n+1}_i\)</span> results in</p>
<!-- Equation labels as ordinary links -->
<div id="wave:pde2:step3b"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
u^{n+1}_i = -u^{n-1}_i + 2u^n_i + C^2
(u^{n}_{i+1}-2u^{n}_{i} + u^{n}_{i-1}) + \Delta t^2 f^n_i
\label{wave:pde2:step3b} \tag{23}
\end{equation}
\]</div>
<p>The equation for the first time step must be rederived. The discretization
of the initial condition <span class="math notranslate nohighlight">\(u_t = V(x)\)</span> at <span class="math notranslate nohighlight">\(t=0\)</span>
becomes</p>
<div class="math notranslate nohighlight">
\[
[D_{2t}u = V]^0_i\quad\Rightarrow\quad u^{-1}_i = u^{1}_i - 2\Delta t V_i,
\]</div>
<p>which, when inserted in (<span class="xref myst">23</span>) for <span class="math notranslate nohighlight">\(n=0\)</span>, gives
the special formula</p>
<!-- Equation labels as ordinary links -->
<div id="wave:pde2:step3c"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
u^{1}_i = u^0_i + \Delta t V_i + {\frac{1}{2}}
C^2
\left(u^{0}_{i+1}-2u^{0}_{i} + u^{0}_{i-1}\right) + \frac{1}{2}\Delta t^2 f^0_i
\label{wave:pde2:step3c} \tag{24}
\end{equation}
\]</div>
</section>
<section id="using-an-analytical-solution-of-physical-significance">
<h2>Using an analytical solution of physical significance<a class="headerlink" href="#using-an-analytical-solution-of-physical-significance" title="Permalink to this heading">#</a></h2>
<div id="wave:pde2:fd:standing:waves"></div>
<p>Many wave problems feature sinusoidal oscillations in time
and space. For example, the original PDE problem
(<span class="xref myst">1</span>)-(<span class="xref myst">5</span>) allows an exact solution</p>
<!-- Equation labels as ordinary links -->
<div id="wave:pde2:test:ue"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
u_e(x,t) = A\sin\left(\frac{\pi}{L}x\right)
\cos\left(\frac{\pi}{L}ct\right)
\label{wave:pde2:test:ue} \tag{25}
\end{equation}
\]</div>
<p>This <span class="math notranslate nohighlight">\(u_e\)</span> fulfills the PDE with <span class="math notranslate nohighlight">\(f=0\)</span>, boundary conditions
<span class="math notranslate nohighlight">\(u_e(0,t)=u_e(L,t)=0\)</span>, as well as initial
conditions <span class="math notranslate nohighlight">\(I(x)=A\sin\left(\frac{\pi}{L}x\right)\)</span> and <span class="math notranslate nohighlight">\(V=0\)</span>.</p>
<p><strong>How to use exact solutions for verification.</strong></p>
<p>It is common to use such exact solutions of physical interest
to verify implementations. However, the numerical
solution <span class="math notranslate nohighlight">\(u^n_i\)</span> will only be an approximation to <span class="math notranslate nohighlight">\(u_e(x_i,t_n)\)</span>.
We have no knowledge of the precise size of the error in
this approximation, and therefore we can never know if discrepancies
between <span class="math notranslate nohighlight">\(u^n_i\)</span> and <span class="math notranslate nohighlight">\(u_e(x_i,t_n)\)</span> are caused
by mathematical approximations or programming errors.
In particular, if plots of the computed solution <span class="math notranslate nohighlight">\(u^n_i\)</span> and
the exact one (<span class="xref myst">25</span>) look similar, many
are tempted to claim that the implementation works. However,
even if color plots look nice and the accuracy is “deemed good”,
there can still be serious programming errors present!</p>
<p>The only way to use exact physical solutions like
(<span class="xref myst">25</span>) for serious and thorough verification is to
run a series of simulations on finer and finer meshes, measure the
integrated error in each mesh, and from this information estimate the
empirical convergence rate of the method.</p>
<p>An introduction to the computing of convergence rates is given in Section 3.1.6
in <span class="xref myst">[Langtangen_decay]</span>.
There is also a detailed example on computing convergence rates in
the <span class="xref myst">verification section</span> of the Vibration ODEs chapter.</p>
<p>In the present problem, one expects the method to have a convergence rate
of 2 (see the section <span class="xref myst">Analysis of the difference equations</span>), so if the computed rates
are close to 2 on a sufficiently fine mesh, we have good evidence that
the implementation is free of programming mistakes.</p>
</section>
<section id="manufactured-solution-and-estimation-of-convergence-rates">
<h2>Manufactured solution and estimation of convergence rates<a class="headerlink" href="#manufactured-solution-and-estimation-of-convergence-rates" title="Permalink to this heading">#</a></h2>
<div id="wave:pde2:fd:MMS"></div>
<section id="specifying-the-solution-and-computing-corresponding-data">
<h3>Specifying the solution and computing corresponding data<a class="headerlink" href="#specifying-the-solution-and-computing-corresponding-data" title="Permalink to this heading">#</a></h3>
<p>One problem with the exact solution (<span class="xref myst">25</span>) is
that it requires a simplification (<span class="math notranslate nohighlight">\({V}=0, f=0\)</span>) of the implemented problem
(<span class="xref myst">17</span>)-(<span class="xref myst">21</span>). An advantage of using
a <em>manufactured solution</em> is that we can test all terms in the
PDE problem. The idea of this approach is to set up some chosen
solution and fit the source term, boundary conditions, and initial
conditions to be compatible with the chosen solution.
Given that our boundary conditions in the implementation are
<span class="math notranslate nohighlight">\(u(0,t)=u(L,t)=0\)</span>, we must choose a solution that fulfills these
conditions. One example is</p>
<div class="math notranslate nohighlight">
\[
u_e(x,t) = x(L-x)\sin t
\]</div>
<p>Inserted in the PDE <span class="math notranslate nohighlight">\(u_{tt}=c^2u_{xx}+f\)</span> we get</p>
<div class="math notranslate nohighlight">
\[
-x(L-x)\sin t = -c^2 2\sin t + f\quad\Rightarrow f = (2c^2 - x(L-x))\sin t
\]</div>
<p>The initial conditions become</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
u(x,0) =&amp; I(x) = 0,\\ 
u_t(x,0) &amp;= V(x) = x(L-x)
\end{align*}
\end{split}\]</div>
</section>
<section id="defining-a-single-discretization-parameter">
<h3>Defining a single discretization parameter<a class="headerlink" href="#defining-a-single-discretization-parameter" title="Permalink to this heading">#</a></h3>
<p>To verify the code, we compute the convergence rates in a series of
simulations, letting each simulation use a finer mesh than the
previous one. Such empirical estimation of convergence rates relies on
an assumption that some measure <span class="math notranslate nohighlight">\(E\)</span> of the numerical error is related
to the discretization parameters through</p>
<div class="math notranslate nohighlight">
\[
E = C_t\Delta t^r + C_x\Delta x^p,
\]</div>
<p>where <span class="math notranslate nohighlight">\(C_t\)</span>, <span class="math notranslate nohighlight">\(C_x\)</span>, <span class="math notranslate nohighlight">\(r\)</span>, and <span class="math notranslate nohighlight">\(p\)</span> are constants. The constants <span class="math notranslate nohighlight">\(r\)</span> and
<span class="math notranslate nohighlight">\(p\)</span> are known as the <em>convergence rates</em> in time and space,
respectively.  From the accuracy in the finite difference
approximations, we expect <span class="math notranslate nohighlight">\(r=p=2\)</span>, since the error terms are of order
<span class="math notranslate nohighlight">\(\Delta t^2\)</span> and <span class="math notranslate nohighlight">\(\Delta x^2\)</span>.  This is confirmed by truncation error
analysis and other types of analysis.</p>
<p>By using an exact solution of the PDE problem, we will next compute
the error measure <span class="math notranslate nohighlight">\(E\)</span> on a sequence of refined meshes and see if
the rates <span class="math notranslate nohighlight">\(r=p=2\)</span> are obtained. We will not be concerned with estimating
the constants <span class="math notranslate nohighlight">\(C_t\)</span> and <span class="math notranslate nohighlight">\(C_x\)</span>, simply because we are not interested in
their values.</p>
<p>mathcal{I}_t is advantageous to introduce a single discretization parameter
<span class="math notranslate nohighlight">\(h=\Delta t=\hat c \Delta x\)</span> for some constant <span class="math notranslate nohighlight">\(\hat c\)</span>.  Since
<span class="math notranslate nohighlight">\(\Delta t\)</span> and <span class="math notranslate nohighlight">\(\Delta x\)</span> are related through the Courant number,
<span class="math notranslate nohighlight">\(\Delta t = C\Delta x/c\)</span>, we set <span class="math notranslate nohighlight">\(h=\Delta t\)</span>, and then <span class="math notranslate nohighlight">\(\Delta x =
hc/C\)</span>.  Now the expression for the error measure is greatly
simplified:</p>
<div class="math notranslate nohighlight">
\[
E = C_t\Delta t^r + C_x\Delta x^r =
C_t h^r + C_x\left(\frac{c}{C}\right)^r h^r
= Dh^r,\quad D = C_t+C_x\left(\frac{c}{C}\right)^r 
\]</div>
</section>
<section id="computing-errors">
<h3>Computing errors<a class="headerlink" href="#computing-errors" title="Permalink to this heading">#</a></h3>
<p>We choose an initial discretization parameter <span class="math notranslate nohighlight">\(h_0\)</span> and run
experiments with decreasing <span class="math notranslate nohighlight">\(h\)</span>: <span class="math notranslate nohighlight">\(h_i=2^{-i}h_0\)</span>, <span class="math notranslate nohighlight">\(i=1,2,\ldots,m\)</span>.
Halving <span class="math notranslate nohighlight">\(h\)</span> in each experiment is not necessary, but it is a common
choice.  For each experiment we must record <span class="math notranslate nohighlight">\(E\)</span> and <span class="math notranslate nohighlight">\(h\)</span>.  Standard
choices of error measure are the <span class="math notranslate nohighlight">\(\ell^2\)</span> and <span class="math notranslate nohighlight">\(\ell^\infty\)</span> norms of the
error mesh function <span class="math notranslate nohighlight">\(e^n_i\)</span>:</p>
<!-- Equation labels as ordinary links -->
<div id="wave:pde2:fd:MMS:E:l2"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
E = ||e^n_i||_{\ell^2} = \left( \Delta t\Delta x
\sum_{n=0}^{N_t}\sum_{i=0}^{N_x}
(e^n_i)^2\right)^{\frac{1}{2}},\quad e^n_i = u_e(x_i,t_n)-u^n_i,
\label{wave:pde2:fd:MMS:E:l2} \tag{26}
\end{equation}
\]</div>
<!-- Equation labels as ordinary links -->
<div id="wave:pde2:fd:MMS:E:linf"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}  
E = ||e^n_i||_{\ell^\infty} = \max_{i,n} |e^n_i|
\label{wave:pde2:fd:MMS:E:linf} \tag{27}
\end{equation}
\]</div>
<p>In Python, one can compute <span class="math notranslate nohighlight">\(\sum_{i}(e^{n}_i)^2\)</span> at each time step
and accumulate the value in some sum variable, say <code class="docutils literal notranslate"><span class="pre">e2_sum</span></code>.  At the
final time step one can do <code class="docutils literal notranslate"><span class="pre">sqrt(dt*dx*e2_sum)</span></code>.  For the
<span class="math notranslate nohighlight">\(\ell^\infty\)</span> norm one must compare the maximum error at a time level
(<code class="docutils literal notranslate"><span class="pre">e.max()</span></code>) with the global maximum over the time domain: <code class="docutils literal notranslate"><span class="pre">e_max</span> <span class="pre">=</span> <span class="pre">max(e_max,</span> <span class="pre">e.max())</span></code>.</p>
<p>An alternative error measure is to use a spatial norm at one time step
only, e.g., the end time <span class="math notranslate nohighlight">\(T\)</span> (<span class="math notranslate nohighlight">\(n=N_t\)</span>):</p>
<!-- Equation labels as ordinary links -->
<div id="_auto6"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
E = ||e^n_i||_{\ell^2} = \left( \Delta x\sum_{i=0}^{N_x}
(e^n_i)^2\right)^{\frac{1}{2}},\quad e^n_i = u_e(x_i,t_n)-u^n_i,
\label{_auto6} \tag{28}
\end{equation}
\]</div>
<!-- Equation labels as ordinary links -->
<div id="_auto7"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}  
E = ||e^n_i||_{\ell^\infty} = \max_{0\leq i\leq N_x} |e^{n}_i|
\label{_auto7} \tag{29}
\end{equation}
\]</div>
<p>The important point is that the error measure (<span class="math notranslate nohighlight">\(E\)</span>) for the simulation is represented by a single number.</p>
</section>
<section id="computing-rates">
<h3>Computing rates<a class="headerlink" href="#computing-rates" title="Permalink to this heading">#</a></h3>
<p>Let <span class="math notranslate nohighlight">\(E_i\)</span> be the error measure in experiment (mesh) number <span class="math notranslate nohighlight">\(i\)</span>
(not to be confused with the spatial index <span class="math notranslate nohighlight">\(i\)</span>) and
let <span class="math notranslate nohighlight">\(h_i\)</span> be the corresponding discretization parameter (<span class="math notranslate nohighlight">\(h\)</span>).
With the error model <span class="math notranslate nohighlight">\(E_i = Dh_i^r\)</span>, we can
estimate <span class="math notranslate nohighlight">\(r\)</span> by comparing two consecutive
experiments:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
E_{i+1}&amp; =D h_{i+1}^{r},\\ 
E_{i}&amp; =D h_{i}^{r}
\end{align*}
\end{split}\]</div>
<p>Dividing the two equations eliminates the (uninteresting) constant <span class="math notranslate nohighlight">\(D\)</span>.
Thereafter, solving for <span class="math notranslate nohighlight">\(r\)</span> yields</p>
<div class="math notranslate nohighlight">
\[
r = \frac{\ln E_{i+1}/E_{i}}{\ln h_{i+1}/h_{i}}
\]</div>
<p>Since <span class="math notranslate nohighlight">\(r\)</span> depends on <span class="math notranslate nohighlight">\(i\)</span>, i.e., which simulations we compare,
we add an index to <span class="math notranslate nohighlight">\(r\)</span>: <span class="math notranslate nohighlight">\(r_i\)</span>, where <span class="math notranslate nohighlight">\(i=0,\ldots,m-2\)</span>, if we
have <span class="math notranslate nohighlight">\(m\)</span> experiments: <span class="math notranslate nohighlight">\((h_0,E_0),\ldots,(h_{m-1}, E_{m-1})\)</span>.</p>
<p>In our present discretization of the wave equation we expect <span class="math notranslate nohighlight">\(r=2\)</span>, and
hence the <span class="math notranslate nohighlight">\(r_i\)</span> values should converge to 2 as <span class="math notranslate nohighlight">\(i\)</span> increases.</p>
</section>
</section>
<section id="constructing-an-exact-solution-of-the-discrete-equations">
<h2>Constructing an exact solution of the discrete equations<a class="headerlink" href="#constructing-an-exact-solution-of-the-discrete-equations" title="Permalink to this heading">#</a></h2>
<div id="wave:pde2:fd:verify:quadratic"></div>
<p>With a manufactured or known analytical solution, as outlined above,
we can estimate convergence rates and see if they have the correct
asymptotic behavior. Experience shows that this is a quite good
verification technique in that many common bugs will destroy the
convergence rates. A significantly better test though,
would be to check that the
numerical solution is exactly what it should be. This will in general
require exact knowledge of the numerical error, which we do not normally have
(although we in the section <span class="xref myst">Analysis of the difference equations</span> establish such knowledge
in simple cases).
However, it is possible to look for solutions where we can show that
the numerical error vanishes, i.e., the solution of the original continuous
PDE problem is
also a solution of the discrete equations. This property often arises
if the exact solution of the PDE
is a lower-order polynomial. (Truncation error
analysis leads to error measures that involve derivatives of the
exact solution. In the present problem, the truncation error involves
4th-order derivatives of <span class="math notranslate nohighlight">\(u\)</span> in space and time. Choosing <span class="math notranslate nohighlight">\(u\)</span>
as a polynomial of degree three or less
will therefore lead to vanishing error.)</p>
<p>We shall now illustrate the construction of an exact solution to both the
PDE itself and the discrete equations.
Our chosen manufactured solution is quadratic in space
and linear in time. More specifically, we set</p>
<!-- Equation labels as ordinary links -->
<div id="wave:pde2:fd:verify:quadratic:uex"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
u_e (x,t) = x(L-x)(1+{\frac{1}{2}}t),
\label{wave:pde2:fd:verify:quadratic:uex} \tag{30}
\end{equation}
\]</div>
<p>which by insertion in the PDE leads to <span class="math notranslate nohighlight">\(f(x,t)=2(1+t)c^2\)</span>. This <span class="math notranslate nohighlight">\(u_e\)</span>
fulfills the boundary conditions <span class="math notranslate nohighlight">\(u=0\)</span> and demands <span class="math notranslate nohighlight">\(I(x)=x(L-x)\)</span>
and <span class="math notranslate nohighlight">\(V(x)={\frac{1}{2}}x(L-x)\)</span>.</p>
<p>To realize that the chosen <span class="math notranslate nohighlight">\(u_e\)</span> is also an exact
solution of the discrete equations,
we first remind ourselves that <span class="math notranslate nohighlight">\(t_n=n\Delta t\)</span> so that</p>
<!-- Equation labels as ordinary links -->
<div id="_auto8"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
\lbrack D_tD_t t^2\rbrack^n = \frac{t_{n+1}^2 - 2t_n^2 + t_{n-1}^2}{\Delta t^2}
= (n+1)^2 -2n^2 + (n-1)^2 = 2,
\label{_auto8} \tag{31}
\end{equation}
\]</div>
<!-- Equation labels as ordinary links -->
<div id="_auto9"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}  
\lbrack D_tD_t t\rbrack^n = \frac{t_{n+1} - 2t_n + t_{n-1}}{\Delta t^2}
= \frac{((n+1) -2n + (n-1))\Delta t}{\Delta t^2} = 0
\label{_auto9} \tag{32}
\end{equation}
\]</div>
<p>Hence,</p>
<div class="math notranslate nohighlight">
\[
[D_tD_t u_e]^n_i = x_i(L-x_i)[D_tD_t (1+{\frac{1}{2}}t)]^n =
x_i(L-x_i){\frac{1}{2}}[D_tD_t t]^n = 0
\]</div>
<p>Similarly, we get that</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
\lbrack D_xD_x u_e\rbrack^n_i &amp;=
(1+{\frac{1}{2}}t_n)\lbrack D_xD_x (xL-x^2)\rbrack_i\\ 
&amp; =
(1+{\frac{1}{2}}t_n)\lbrack LD_xD_x x - D_xD_x x^2\rbrack_i \\ 
&amp;= -2(1+{\frac{1}{2}}t_n)
\end{align*}
\end{split}\]</div>
<p>Now, <span class="math notranslate nohighlight">\(f^n_i = 2(1+{\frac{1}{2}}t_n)c^2\)</span>, which results in</p>
<div class="math notranslate nohighlight">
\[
[D_tD_t u_e - c^2D_xD_xu_e - f]^n_i = 0 +
c^2 2(1 + {\frac{1}{2}}t_{n}) +
2(1+{\frac{1}{2}}t_n)c^2 = 0
\]</div>
<p>Moreover, <span class="math notranslate nohighlight">\(u_e(x_i,0)=I(x_i)\)</span>,
<span class="math notranslate nohighlight">\(\partial u_e/\partial t = V(x_i)\)</span> at <span class="math notranslate nohighlight">\(t=0\)</span>, and
<span class="math notranslate nohighlight">\(u_e(x_0,t)=u_e(x_{N_x},0)=0\)</span>. Also the modified scheme for the
first time step is fulfilled by <span class="math notranslate nohighlight">\(u_e(x_i,t_n)\)</span>.</p>
<p>Therefore, the exact solution <span class="math notranslate nohighlight">\(u_e(x,t)=x(L-x)(1+t/2)\)</span> of the PDE
problem is also an exact solution of the discrete problem.  This means
that we know beforehand what numbers the numerical algorithm should
produce.  We can use this fact to check that the computed <span class="math notranslate nohighlight">\(u^n_i\)</span>
values from an implementation equals <span class="math notranslate nohighlight">\(u_e(x_i,t_n)\)</span>, within machine
precision.  This result is valid <em>regardless of the mesh spacings</em>
<span class="math notranslate nohighlight">\(\Delta x\)</span> and <span class="math notranslate nohighlight">\(\Delta t\)</span>!  Nevertheless, there might be stability
restrictions on <span class="math notranslate nohighlight">\(\Delta x\)</span> and <span class="math notranslate nohighlight">\(\Delta t\)</span>, so the test can only be run
for a mesh that is compatible with the stability criterion (which in
the present case is <span class="math notranslate nohighlight">\(C\leq 1\)</span>, to be derived later).</p>
<p><strong>Notice.</strong></p>
<p>A product of quadratic or linear expressions in the various
independent variables, as shown above, will often fulfill both the
PDE problem and the discrete equations, and can therefore be very useful
solutions for verifying implementations.</p>
<p>However, for 1D wave
equations of the type <span class="math notranslate nohighlight">\(u_{tt}=c^2u_{xx}\)</span> we shall see that there is always
another much more powerful way of generating exact
solutions (which consists in just setting <span class="math notranslate nohighlight">\(C=1\)</span> (!), as shown in
the section <span class="xref myst">Analysis of the difference equations</span>).</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/02_wave"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="../01_vib/vib_placeholder.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Coming soon</p>
      </div>
    </a>
    <a class="right-next"
       href="wave1D_prog.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Implementation</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Simulation of waves on a string</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discretizing-the-domain">Discretizing the domain</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#uniform-meshes">Uniform meshes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-discrete-solution">The discrete solution</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fulfilling-the-equation-at-the-mesh-points">Fulfilling the equation at the mesh points</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#replacing-derivatives-by-finite-differences">Replacing derivatives by finite differences</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#algebraic-version-of-the-pde">Algebraic version of the PDE</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpretation-of-the-equation-as-a-stencil">Interpretation of the equation as a stencil</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#algebraic-version-of-the-initial-conditions">Algebraic version of the initial conditions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#formulating-a-recursive-algorithm">Formulating a recursive algorithm</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sketch-of-an-implementation">Sketch of an implementation</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#verification">Verification</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-slightly-generalized-model-problem">A slightly generalized model problem</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-an-analytical-solution-of-physical-significance">Using an analytical solution of physical significance</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#manufactured-solution-and-estimation-of-convergence-rates">Manufactured solution and estimation of convergence rates</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#specifying-the-solution-and-computing-corresponding-data">Specifying the solution and computing corresponding data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-a-single-discretization-parameter">Defining a single discretization parameter</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#computing-errors">Computing errors</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#computing-rates">Computing rates</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#constructing-an-exact-solution-of-the-discrete-equations">Constructing an exact solution of the discrete equations</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Devito Project Community
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>